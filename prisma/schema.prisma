generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id            String          @id @default(cuid())
  name          String
  email         String          @unique
  password      String
  role          String
  schoolId      String?
  createdAt     DateTime        @default(now())

  audioUploads  ClassAudio[]
  attendances   Attendance[]
  lessonAnalysis LessonAnalysis[]
  studentWork   StudentWork[]

  @@index([role])
  @@index([schoolId])
}

model ClassAudio {
  id         String   @id @default(cuid())
  teacherId  String
  audioUrl   String
  date       DateTime @default(now())

  teacher    User     @relation(fields: [teacherId], references: [id])
  analyses   LessonAnalysis[]

  @@index([teacherId])
  @@index([date])
}

model Attendance {
  id         String   @id @default(cuid())
  teacherId  String
  date       DateTime @default(now())
  status     String

  teacher    User     @relation(fields: [teacherId], references: [id])

  @@index([teacherId])
  @@index([date])
}

model LessonAnalysis {
  id                 String   @id @default(cuid())
  teacherId          String
  audioId            String
  syllabusMatch      Boolean
  repetitionDetected Boolean
  strengths          Json
  improvements       Json
  summary            String
  feedback           String
  createdAt          DateTime @default(now())

  teacher            User       @relation(fields: [teacherId], references: [id])
  audio              ClassAudio @relation(fields: [audioId], references: [id])

  @@index([teacherId])
  @@index([audioId])
  @@index([createdAt])
}

model StudentWork {
  id         String   @id @default(cuid())
  teacherId  String
  fileUrl    String
  type       String
  createdAt  DateTime @default(now())

  teacher    User @relation(fields: [teacherId], references: [id])

  @@index([teacherId])
  @@index([createdAt])
}

model MonthlyReport {
  id             String   @id @default(cuid())
  schoolId       String
  month          String
  teacherReport  Json
  studentReport  Json
  impactReport   Json
  createdAt      DateTime @default(now())

  @@index([schoolId])
  @@index([month])
}

